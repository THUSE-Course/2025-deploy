# 小作业部署说明

### 起因

- 往年大作业前期往往难以实际将项目部署上线，因此我们希望在小作业中模拟大作业部署全流程，让同学们对 CI/CD 概念有基本了解，能够快速上手大作业
- (以前学期情况) SECoder 分配容器 IP 受到网段限制，不足以为每位同学都开放前端和后端两个容器。此问题现在已经解决，但为了让大家熟悉本地 Docker 部署的流程（真的是因为这个），我们依然使用了新方案。

---

# 小作业部署说明

### 新方案

- 仅为各位同学开放前端容器供大家完成 CI/CD 小作业的前端部署部分
- 部署一个标准后端供大家对接、测试、使用
- 后端部署部分则由各位同学自行完成并测试，不部署到 SECoder 平台

---

# 小作业部署说明

### 作业文档

https://thuse-course.github.io/course-index/handout/ci-cd/

- 后端部署请务必在本地测试，否则可能造成不必要的失分
- 前端部署请务必仔细阅读文档，按照要求的方式 (standalone) 部署。采用其他方式也可成功部署 (例如直接全部 `COPY` 后 `yarn dev`)，但由于不完全符合作业要求，我们会酌情扣分。

---

# 小作业部署说明

### 提醒

- 小作业设计中对安全并没有过多考虑，例如直接明文传输、存储了密码，这可能带来一定安全隐患
  - 大作业时请务必做好用户身份识别和数据库安全
- 数据量可能会达到上百条，但前端小作业列表页面并未设置分页器，可能会导致加载速度慢等问题
  - 大作业时涉及到的数据可能会更大，请务必设计分页器等限制措施
- 同学间可以更方便地共享有趣的游戏记录（？）
- *切勿攻击共享后端*

---

# 小作业部署说明

### 提醒

- 切勿赶DDL.在 DDL 前 Runner 压力可能非常高，这将可能导致排队时间过长而错过 DDL。我们会尝试在小作业 DDL 前借一些额外的算力以提高小作业 CI 的并发量，但不能保证排队时间过长的问题不出现。
  - 大作业也同理，尽量不要赶组会前集中迭代。我们会尝试在大作业时限制 *每个组* 的 CI 并发量（而非与往年一样整体限制并发量）
- 可以取消不必要的 CI，比如若短时间内 Push 了多次 Commit，可以在 Gitlab 的 CI 管理里面点击更旧的 CI 并点击 “Cancel” 以取消这次 CI。
- 仓库权限要开成 *Private*
  - 而不是 Internal，否则所有人都会看到你的作业

---

# 小作业部署说明

### 提醒

- Deployer 会以 *最后一次* 运行 Deployer 的镜像作为生产镜像
  - 这可能导致由于网速问题等，短时间内的两次 Deploy 可能逆序进入 Deploy 阶段，以至于最终上线的是倒数第二个（甚至更早的） Commit。